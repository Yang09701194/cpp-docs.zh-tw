---
title: 回溯程序
ms.date: 11/04/2016
ms.assetid: 82c5d0ca-70be-4d1a-a306-bfe01c29159f
ms.openlocfilehash: 2d68a5c3fb1cc2d18b587d1419b0103d02b35a7f
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/31/2018
ms.locfileid: "50523087"
---
# <a name="unwind-procedure"></a>回溯程序

回溯程式碼陣列是以遞減順序排序。 發生例外狀況時，完整的內容會儲存為內容記錄中的作業系統。 例外狀況分派邏輯會再叫用，它會重複執行下列步驟，以尋找例外狀況處理常式。

1. 您可以使用目前的內容記錄中儲存的 RIP 來搜尋 RUNTIME_FUNCTION 資料表項目，用來描述目前的函式 （或函式的部分，在鏈結 UNWIND_INFO 項目）。

1. 如果不找到任何函式表項目，則它是分葉函式，位在和 rsp 會直接傳回的指標。 在 [RSP] 傳回的指標會儲存在已更新的內容、 模擬的 RSP 加 8，和會重複步驟 1。

1. 如果找到函式表項目，RIP 可以體內） 中的終解、 b） 在初構中，或是 c） 在可能的例外狀況處理常式所涵蓋的程式碼的三個區域中。

   - 大小寫) 如果 RIP 是在終解，則控制項將離開函式可以有任何為此函式，此例外狀況相關聯的例外狀況處理常式，必須繼續終解效果，以計算呼叫端函式的內容。 若要判斷 RIP 是否在終解中，從擷取的程式碼資料流中，在檢查。 如果合法的終解中的尾端部分可符合該程式碼資料流處於終解中，然後模擬終解的其餘部分時，會處理與更新為每個指示的內容記錄。 在此之後，請重複步驟 1。

   - 案例 b） 如果 RIP 在序言，則控制項不進入函式可以有任何為此函式，此例外狀況相關聯的例外狀況處理常式，必須復原的初構效果，以計算呼叫端函式的內容。 RIP 是初構中，如果函式開始擷取之間的距離小於或等於初構大小，以回溯資訊編碼。 初構的效果是回溯掃描回溯程式碼陣列的位移小於或等於從函式開始時，RIP 位移的第一個項目，然後復原的回溯程式碼陣列中的所有剩餘項目的影響。 然後重複步驟 1。

   - 案例 c) 如果 RIP 在初構和終解函式不是例外狀況處理常式 （UNW_FLAG_EHANDLER 設定），則語言特定處理常式會呼叫。 處理常式會掃描其資料，並呼叫篩選為適當的函式。 語言特定處理常式可以傳回已處理例外狀況，或搜尋是以繼續。 它也可以直接初始化回溯。

1. 如果語言特定處理常式會傳回已處理的狀態，則執行會繼續使用原始的內容記錄。

1. 如果沒有任何語言特定處理常式或處理常式會傳回 「 繼續搜尋 」 的狀態，則內容記錄必須回溯至呼叫端的狀態。 這是藉由處理所有的回溯程式碼陣列項目，並復原每個作用中完成。 然後重複步驟 1。

當進行鏈結時回溯的相關資訊，還是會進行下列基本步驟。 唯一的差別是，雖然查核回溯初構的效果，一旦達到陣列結尾對回溯程式碼陣列，它會接著連結至父回溯資訊，並在那裡找到完整的回溯程式碼陣列便移動。 此連結會繼續直到到達的回溯資訊不 UNW_CHAINED_INFO 旗標，並完成逐一查看其回溯程式碼陣列。

回溯資料以最小一組 8 個位元組。 這代表的函式只會配置 128 個位元組的堆疊或更少，並可能是儲存一個靜態暫存器。 這也是大小鏈結的回溯資訊結構的長度為零的初構沒有回溯程式碼使用。

## <a name="see-also"></a>另請參閱

[例外狀況處理 (x64)](../build/exception-handling-x64.md)