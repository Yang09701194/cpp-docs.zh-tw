---
title: 資料錄集：動態地繫結資料行 (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets [C++], binding columns dynamically
- data binding [C++], recordset columns
- recordsets [C++], binding data
- data binding [C++], columns in recordsets
- columns [C++], binding to recordsets
ms.assetid: bff67254-d953-4ae4-9716-91c348cb840b
ms.openlocfilehash: 0284fbeed23c5fdad47cafd29af7a47251b923a0
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/31/2018
ms.locfileid: "50469676"
---
# <a name="recordset-dynamically-binding-data-columns-odbc"></a>資料錄集：動態地繫結資料行 (ODBC)

本主題適用於 MFC ODBC 類別。

資料錄集中管理您在設計階段指定的繫結資料行，但一些情況下您可能想要在設計階段所知道的資料行繫結。 本主題說明：

- [當您可能想要動態繫結資料行，資料錄集](#_core_when_you_might_bind_columns_dynamically)。

- [如何在執行階段動態地繫結資料行](#_core_how_to_bind_columns_dynamically)。

> [!NOTE]
>  本主題適用於物件衍生自`CRecordset`的大量資料列中擷取尚未實作。 如果您使用大量資料列擷取，不建議您使用通常所述的技巧。 如需有關大量資料列擷取的詳細資訊，請參閱[資料錄集： 擷取記錄中大量資料庫連接 (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)。

##  <a name="_core_when_you_might_bind_columns_dynamically"></a> 當您可能會繫結資料行動態

在設計階段，MFC 應用程式精靈或[MFC ODBC 消費者精靈](../../mfc/reference/adding-an-mfc-odbc-consumer.md)(從**加入類別**) 建立的已知的資料表和資料行在資料來源為基礎的資料錄集類別。 當您設計它們和更新版本，當您的應用程式在執行階段使用這些資料表和資料行時，可以變更資料庫。 您或另一位使用者可能會加入或卸除的資料表或新增或卸除資料行，從您的應用程式資料錄集依賴的資料表。 這可能不需要考量所有的資料存取應用程式，但如果它是供您，如何可以您處理資料庫結構描述，而非重新設計，並重新編譯中的變更嗎？ 本主題的目的是為了回答這個問題。

本主題說明最常見的案例中您可能會動態繫結資料行，與已知的資料庫結構描述為基礎的資料錄集開始，您想要在執行階段處理額外的資料行。 本主題進一步假設其他資料行對應至`CString`欄位資料成員，最常見的情況下，雖然有提供建議來協助您管理其他資料型別。

您可以使用少量的額外的程式碼：

- [判斷哪些資料行可用在執行階段](#_core_how_to_bind_columns_dynamically)。

- [其他資料行繫結至您的資料錄集，以動態方式在執行階段](#_core_adding_the_columns)。

資料錄集仍包含您在設計階段知道資料行的資料成員。 它也包含少量額外的程式碼以動態方式決定任何新資料行是否已新增至您的目標資料表，而且如果是這樣，繫結這些新的資料行至動態配置的儲存體 （而不是資料錄集的資料成員）。

本主題並未涵蓋其他動態繫結案例，例如卸除之資料表或資料行。 針對這些情況下，您需要更直接使用 ODBC API 呼叫。 如需資訊，請參閱 ODBC SDK*程式設計人員參考*MSDN Library CD 上。

##  <a name="_core_how_to_bind_columns_dynamically"></a> 如何將繫結資料行動態

動態繫結資料行，您必須知道 （或能夠判斷） 的額外資料行的名稱。 您也必須將存放裝置配置額外的欄位資料成員、 指定其名稱和其類型，並且指定您要新增的資料行數目。

以下討論中提及的兩個不同的資料錄集。 第一個是主要的資料錄集選取目標資料表中的記錄。 第二個是用來取得資料行的相關資訊，目標資料表中的特殊資料行資料錄集。

###  <a name="_core_the_general_process"></a> 一般程序

在最一般的層級，請遵循下列步驟：

1. 建構您的主要資料錄集物件。

   （選擇性） 將指標傳遞給開啟`CDatabase`物件或能夠提供以其他方式在資料行資料錄集的連接資訊。

1. 採取步驟，以動態方式加入資料行。

   請參閱加入以下資料行中所述的程序。

1. 開啟您的主要資料錄集。

   資料錄集選取記錄，並使用資料錄欄位交換 (RFX) 繫結的靜態資料行 （其對應至資料錄集的欄位資料成員） 和動態資料行 （對應至您所配置的額外儲存空間）。

###  <a name="_core_adding_the_columns"></a> 加入資料行

動態繫結加入資料行，在執行階段需要下列步驟：

1. 在執行階段判斷資料行是目標資料表中。 因為您的資料錄集類別的設計已加入至資料表的資料行清單擷取該資訊。

   是不錯的方法是使用設計成查詢 （例如資料行名稱和資料類型） 的目標資料表的資料行資訊的資料來源的資料行的資料錄集類別。

1. 提供新的欄位資料成員的儲存體。 因為您的主要資料錄集類別並沒有未知的資料行的欄位資料成員，您必須提供一個位置來儲存名稱、 結果值，以及可能的資料類型資訊 （如果資料行不同的資料類型）。

   其中一個方法是建置一或多個動態清單，一個用於新的資料行名稱，另一個其結果值，以及第三個針對其資料類型 （如有必要）。 這些清單中，特別是值清單中，提供的資訊，並繫結的必要儲存體。 下圖說明建置清單。

   ![建置要動態繫結的資料行的清單](../../data/odbc/media/vc37w61.gif "vc37w61")<br/>
   建置要動態繫結的資料行清單

1. RFX 函式呼叫增益集主要資料錄集的`DoFieldExchange`函式每個加入資料行。 這些 RFX 呼叫進行擷取資料錄，包括其他的資料行，和資料行繫結至資料錄集資料成員，或您以動態方式提供的儲存體為其的工作。

   其中一個方法是將迴圈加入至您主要資料錄集的`DoFieldExchange`循環新的資料行，每個資料行清單中，呼叫適當的 RFX 函式的程式清單的函式。 在每個 RFX 呼叫時，請從 [資料行名稱] 清單和對應成員的結果值清單中的儲存體位置傳遞的資料行名稱。

###  <a name="_core_lists_of_columns"></a> 資料行清單

下表中，會顯示您要使用的四個清單。

|||
|-|-|
|**目前資料表的資料行**| （圖中的清單 1）在資料來源的資料表中的目前資料行清單。 這份清單可能會比對目前繫結資料錄集中的資料行清單。|
|**繫結資料錄集資料行**| （圖中的清單 2）資料錄集繫結的資料行清單。 這些資料行已經有 RFX 陳述式，您`DoFieldExchange`函式。|
|**資料行來-動態繫結**| （圖中的清單 3）在資料表中，但不是在資料錄集的資料行清單。 這些是您想要動態繫結的資料行。|
|**動態資料行值**| （圖中的清單 4）包含值的儲存體的清單擷取自您動態繫結資料行。 此清單的項目對應於資料行來-動態繫結，一對一。|

###  <a name="_core_building_your_lists"></a> 建置您的清單

了解一般策略，您可以開啟詳細資料。 本主題的其餘部分中的程序會示範如何建置清單所示[列出的資料行](#_core_lists_of_columns)。 程序會引導您：

- [決定不在資料錄集的資料行名稱](#_core_determining_which_table_columns_are_not_in_your_recordset)。

- [提供動態的存放裝置新增至資料表的資料行](#_core_providing_storage_for_the_new_columns)。

- [新的資料行以動態方式新增 RFX 呼叫](#_core_adding_rfx_calls_to_bind_the_columns)。

###  <a name="_core_determining_which_table_columns_are_not_in_your_recordset"></a> 決定不在資料錄集的資料表資料行

建立包含一份已繫結到主要資料錄集的資料行的清單 （繫結的資料錄集-資料行，如圖中的清單 2）。 然後建立的清單 （資料行來-動態繫結，衍生自目前資料表的資料行和繫結資料錄集資料行） 包含在資料來源的資料表中，但不在主要資料錄集的資料行名稱。

##### <a name="to-determine-the-names-of-columns-not-in-the-recordset-columns-to-bind-dynamically"></a>若要判斷不在資料錄集 （資料行來-動態繫結） 中的資料行的名稱

1. 建置已繫結到主要資料錄集的資料行清單 （繫結資料錄集的資料行）。

   其中一個方法是在設計階段建立繫結資料錄集資料行。 您可以以視覺化方式檢查 RFX 函式呼叫，在資料錄集的`DoFieldExchange`函式可取得這些名稱。 然後，將您的清單設定為使用名稱初始化陣列。

   例如，圖會顯示繫結資料錄集的資料行 」 (清單 2) 具有三個元素。 繫結資料錄集資料行遺漏 Phone 資料行目前資料表的資料行 」 (清單 1) 所示。

1. 比較目前的資料表資料行和繫結資料錄集資料行來建立未繫結主要資料錄集中的資料行 （資料行來-動態繫結） 清單。

   其中一個方法是在執行的階段 （目前資料表的資料行） 和您已經以平行方式繫結資料錄集 （繫結資料錄集的資料行） 中的資料行的清單執行迴圈您資料表中的資料行清單。 到 資料行來-動態繫結置於目前的資料表-資料行不會出現在 繫結資料錄集資料行中的任何名稱。

   比方說，此圖顯示資料行來-動態繫結 (清單 3) 有一個項目： 在目前資料表的資料行 」 (清單 1)，但不是會在繫結資料錄集的資料行 」 (清單 2) 中找到的 Phone 資料行。

1. 建立動態資料行值 （如同在圖例中的清單 4) 的清單，用來儲存資料值會對應至每個資料行名稱儲存在您要動態繫結的資料行清單 （資料行來-動態繫結）。

   這份清單的項目扮演角色的新資料錄集的欄位資料成員。 它們是動態的資料行所繫結的儲存體位置。 如需清單的描述，請參閱[列出的資料行](#_core_lists_of_columns)。

###  <a name="_core_providing_storage_for_the_new_columns"></a> 提供新的資料行的儲存體

接下來，設定動態繫結的資料行的儲存位置。 其概念是要提供用來儲存每個資料行值的清單項目。 這些儲存體位置的平行存放區通常繫結的資料行的資料錄集成員變數。

#### <a name="to-provide-dynamic-storage-for-new-columns-dynamic-column-values"></a>提供動態的儲存體 （動態資料行值） 的新資料行

1. 建置動態資料行值，平行資料行來-動態繫結，以包含每個資料行中的資料值。

   比方說，此圖會顯示動態資料行值 (清單 4) 有一個項目：`CString`物件，包含目前記錄的實際的電話號碼: 「 555-1212"。

   在最常見的情況下，動態資料行值具有類型的項目`CString`。 如果您正在處理的各種不同的資料類型資料行，您需要可以包含各種類型的項目清單。

上述的程序的結果是兩個主要的清單： 資料行來-動態繫結包含名稱的資料行和動態資料行值包含目前資料錄的資料行中的值。

> [!TIP]
> 如果新的資料行不是所有相同的資料類型，您可以額外的平行清單包含資料行清單中定義的每個對應的項目類型的項目。 （您可以使用值 AFX_RFX_BOOL，AFX_RFX_BYTE，並依此類推，此資料庫，如果您想。 這些常數定義於 AFXDB。H.)選擇清單類型，以代表資料行資料類型的方式。

###  <a name="_core_adding_rfx_calls_to_bind_the_columns"></a> 繫結資料行加入 RFX 呼叫

最後，安排 RFX 呼叫新的資料行中加上所發生的動態繫結您`DoFieldExchange`函式。

##### <a name="to-dynamically-add-rfx-calls-for-new-columns"></a>以動態方式加入新的資料行的 RFX 呼叫

1. 您主要資料錄集中`DoFieldExchange`成員函式中，加入新的資料行 （資料行來-動態繫結） 的程式清單中執行迴圈的程式碼。 在每個迴圈中，請從資料行來-動態繫結和動態資料行值的資料行的結果值中擷取的資料行名稱。 傳遞的 RFX 函式呼叫的這些項目適用於資料行的資料類型。 如需清單的描述，請參閱[列出的資料行](#_core_lists_of_columns)。

常見的情況下，在您`RFX_Text`函式會呼叫您擷取`CString`從清單中，如下列程式碼，其中資料行來-動態繫結是行所示的物件`CStringList`稱為`m_listName`動態資料行值，且  `CStringList`稱為`m_listValue`:

```cpp
RFX_Text( pFX,
            m_listName.GetNext( posName ),
            m_listValue.GetNext( posValue ));
```

如需 RFX 函式的詳細資訊，請參閱[巨集和全域](../../mfc/reference/mfc-macros-and-globals.md)中*類別庫參考*。

> [!TIP]
> 如果新的資料行都是不同的資料類型，請在您迴圈中使用 switch 陳述式，來為每個型別呼叫適當的 RFX 函式。

當架構會呼叫`DoFieldExchange`期間`Open`靜態的資料行，請繫結的資料行，將資料行繫結至資料錄集，RFX 呼叫的程序。 然後您的迴圈重複呼叫 RFX 函式的動態資料行。

## <a name="see-also"></a>另請參閱

[資料錄集 (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[資料錄集：使用大型的資料項目 (ODBC)](../../data/odbc/recordset-working-with-large-data-items-odbc.md)